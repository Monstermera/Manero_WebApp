@using System.Globalization;
@model Manero_WebApp.Models.Schemas.ProductModel

    <div class="p-cards">
        <div class="p-card">
            <div class="card-body">
                <a asp-controller="Home" asp-action="ProductDetails" asp-route-articleNumber="@Model.ArticleNumber" class="product-link">
                    <div class="card-start">
                        @if (Model.Tags.Contains("sale"))
                        {
                            <div class="sale-label">SALE</div>
                        }

                        <img src="@(!string.IsNullOrEmpty(Model.ImageUrl.FirstOrDefault()) ? Model.ImageUrl.FirstOrDefault() : "https://placehold.co/200x250?text=No\\nimage")" alt="@Model.Name" class="wishlist-image">
  
                        <div class="card-middle">
                            <div class="product-name">@Model.Name</div>
                            <div class="product-price">
                                $@Model.Price.ToString("N2", CultureInfo.CreateSpecificCulture("en-US"))
                                @if (Model.Tags.Contains("sale"))
                                {
                                    <span class="product-discount">$@((Model.Price * 0.5m).ToString("N2", CultureInfo.CreateSpecificCulture("en-US")))</span>
                                }
                            </div>
                            <div class="product-rating">
                                @{
                                    var averageRating = Model.Reviews.Any() ? Model.Reviews.Average(r => r.Rating) : 0;
                                    var numberOfReviews = Model.Reviews.Count;
                                }
                                @for (var i = 0; i < (int)Math.Round(averageRating); i++)
                                {
                                    <i class="fa-solid fa-star"></i>
                                }

                                @for (var i = 0; i < 5 - (int)Math.Round(averageRating); i++)
                                {
                                    <i class="fa-regular fa-star"></i>
                                }
                                <div class="nr">
                                    (@numberOfReviews)
                                </div>
                            </div>
                        </div>

                    </div>
                </a>

                <div class="card-end">
                    <button class="card-end-button" id="removebutton-@(Model.ArticleNumber)" type="button" onclick="removeFromWishlist('@Model.ArticleNumber')">
                    <i id="removeicon-@(Model.ArticleNumber)" class="card-end-heart fa-solid fa-heart"></i>
                    </button>
                    <div class="card-end-bag"><i class="fa-light fa-bag-shopping"></i></div>
                </div>
            </div>

        </div>
    </div>

<script>
    async function removeFromWishlist(articleNumber)
    {
        var response = await fetch(`/Wishlist/Remove?articleNumber=${articleNumber}`);
        var result = await response.json();

        if (response.status == 200)
        {
            window.location.reload();
        }
    }
</script>
