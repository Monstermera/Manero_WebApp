@using System.Globalization;
@model Manero_WebApp.Models.Schemas.ProductModel


<div class="bestsellers-mobile">
    <div class="container">
        <div class="products">
            <div class="product-icons">
                <button class="product-icon-button" id="wishlistbutton-@(Model.ArticleNumber)" type="button" onclick="addToWishlist('@Model.ArticleNumber')">
                    <i id="wishlisticon-@(Model.ArticleNumber)" class="fa-light fa-heart"></i>
                </button>
                <div class="product-icon-bag"><i class="fa-light fa-bag-shopping"></i></div>
            </div>

            <a asp-controller="Home" asp-action="ProductDetails" asp-route-articleNumber="@Model.ArticleNumber" class="product-link">
                @if (Model.Tags.Contains("sale"))
                {
                    <div class="sale-label">SALE</div>
                }
                <img src="@(!string.IsNullOrEmpty(Model.ImageUrl.FirstOrDefault()) ? Model.ImageUrl.FirstOrDefault() : "https://placehold.co/200x250?text=No\\nimage")" alt="@Model.Name" class="product-image">

                <div class="product-rating">
                    @{
                        var averageRating = Model.Reviews.Any() ? Model.Reviews.Average(r => r.Rating) : 0;
                        var numberOfReviews = Model.Reviews.Count;
                    }
                    @for (var i = 0; i < (int)Math.Round(averageRating); i++)
                    {
                        <i class="fa-solid fa-star"></i>
                    }

                    @for (var i = 0; i < 5 - (int)Math.Round(averageRating); i++)
                    {
                        <i class="fa-regular fa-star"></i>
                    }
                    <div class="nr">
                        (@numberOfReviews)
                    </div>

                </div>
                <div class="product-name">@Model.Name</div>
                <div class="product-price">
                    $@Model.Price.ToString("N2", CultureInfo.CreateSpecificCulture("en-US"))
                    @if (Model.Tags.Contains("sale"))
                    {
                        <span class="product-discount">$@((Model.Price * 0.5m).ToString("N2", CultureInfo.CreateSpecificCulture("en-US")))</span>
                    }
                </div>

            </a>
        </div>

    </div>

</div>

<div class="bestsellers-desktop">
    <div class="container">
        <div class="products">
            <div class="product-icons">
                <button class="product-icon-button" id="wishlistbutton-@(Model.ArticleNumber)" type="button" onclick="addToWishlist('@Model.ArticleNumber')">
                    <i id="wishlisticon-@(Model.ArticleNumber)" class="fa-light fa-heart"></i>
                </button>
                <div><i class="product-icon-bag fa-light fa-bag-shopping"></i></div>
            </div>

            <a asp-controller="Home" asp-action="ProductDetails" asp-route-articleNumber="@Model.ArticleNumber" class="product-link">
                @if (Model.Tags.Contains("sale"))
                {
                    <div class="sale-label">SALE</div>
                }
                <img src="@(!string.IsNullOrEmpty(Model.ImageUrl.FirstOrDefault()) ? Model.ImageUrl.FirstOrDefault() : "https://placehold.co/200x250?text=No\\nimage")" alt="@Model.Name" class="product-image">

                <div class="product-rating">
                    @{
                        var averageRating = Model.Reviews.Any() ? Model.Reviews.Average(r => r.Rating) : 0;
                        var numberOfReviews = Model.Reviews.Count;
                    }
                    @for (var i = 0; i < (int)Math.Round(averageRating); i++)
                    {
                        <i class="fa-solid fa-star"></i>
                    }

                    @for (var i = 0; i < 5 - (int)Math.Round(averageRating); i++)
                    {
                        <i class="fa-regular fa-star"></i>
                    }
                    <div class="nr">
                        (@numberOfReviews)
                    </div>

                </div>
                <div class="product-name">@Model.Name</div>
                <div class="product-price">
                    $@Model.Price.ToString("N2", CultureInfo.CreateSpecificCulture("en-US"))
                    @if (Model.Tags.Contains("sale"))
                    {
                        <span class="product-discount">$@((Model.Price * 0.5m).ToString("N2", CultureInfo.CreateSpecificCulture("en-US")))</span>
                    }
                </div>

            </a>
        </div>

    </div>

</div>


<script>
    async function addToWishlist(articleNumber) {
        var response = await fetch(`/Wishlist/Add?articleNumber=${articleNumber}`);
        var result = await response.json();

        if (response.status == 200) {
            var wishlistbutton = document.getElementById(`wishlisticon-${articleNumber}`);
            wishlistbutton.classList.remove("fa-light");
            wishlistbutton.classList.remove("fa-heart");
            wishlistbutton.classList.add("fa-solid");
            wishlistbutton.classList.add("fa-heart");
        }
    }
</script>
